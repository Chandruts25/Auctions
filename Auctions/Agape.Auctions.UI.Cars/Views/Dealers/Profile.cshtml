@model Agape.Auctions.UI.Cars.Models.Dealer
@{
    if (!string.IsNullOrWhiteSpace(ViewBag.Layout))
    {
        Layout = "~/Views/Shared/" + ViewBag.Layout;
    }
    else
    {
        Layout = "_Layout_Page";
    }
    var ownerName = string.Empty;
    // if (!(string.IsNullOrEmpty(Model.Id)))
    ownerName = @User.Identity.Name;

}

<div class="top3-wrapper novi-background bg-cover">
    <div class="container">
        <div class="top2 clearfix">

            <div class="row">

                <div class="col-md-6">
                    <h4> <b> My Profile </b> </h4>
                </div>

                <div class="col-md-6 float-right">

                </div>

            </div>

        </div>

    </div>
</div>

<div class="breadcrumbs1_wrapper novi-background">
    <div class="container">
        <div class="breadcrumbs1"><a asp-controller="Admin" asp-action="Dashboard">Dashboard</a><span></span>My Profile</div>
    </div>
</div>

<div class="container">
    <div class="row" id="divShowErrorSuccess">
        <div class="col-md-12" id="divDetailText">

        </div>
    </div>
</div>


<div class="content section-md-bottom novi-background bg-cover">

    <div class="container">
        <div class="row row-fix">
            <div class="col-sm-12 col-md-12 column-content">
                <div class="sectionBlock">
                    <h5 class="stitle">My Profile </h5>
                    <div class="sectionContent">
                        <div class="subgroup">
                            <!-- ------------------- -->
                            <div class="container">

                                        <div class="col-md-12 tab-content-border">

                                            <div class="row">
                                                <div class="col-md-3 mb-3">
                                                    <h4>User Details</h4>
                                                </div>
                                            </div>

                                            <div class="row mt-20">

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtFirstName">First Name <span class="red-req">*</span></label>
                                                    <input type="text" id="txtFirstName" class="form-control" value="@Model.UserDetail.FirstName" onkeypress="removeInvalidClass('txtFirstName')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtLastName">Last Name <span class="red-req">*</span></label>
                                                    <input type="text" id="txtLastName" class="form-control" value="@Model.UserDetail.LastName" onkeypress="removeInvalidClass('txtLastName')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtUserEmail">Email Address <span class="red-req">*</span></label>
                                                    <input type="text" id="txtUserEmail" class="form-control" value="@Model.UserDetail.Email" disabled />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtUserCountry">Country <span class="red-req">*</span></label>
                                                    <input type="text" id="txtUserCountry" class="form-control" value="@Model.UserDetail.Address.Country" onkeypress="removeInvalidClass('txtUserCountry')" />
                                                </div>

                                            </div>

                                            <div class="row" style="margin-top:10px">
                                                <div class="col-md-3 mb-3">
                                                    <h4>Company Details</h4>
                                                </div>
                                            </div>

                                            <div class="row mt-20">

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtCompanyName">Company Name <span class="red-req">*</span></label>
                                                    <input type="text" id="txtCompanyName" class="form-control" value="@Model.CompanyName" onkeypress="removeInvalidClass('txtCompanyName')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtCompanyEmail">Company Email <span class="red-req">*</span></label>
                                                    <input type="text" id="txtCompanyEmail" class="form-control" value="@Model.Email" onkeypress="removeInvalidClass('txtCompanyEmail')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtCompanyPhone">Company Phone <span class="red-req">*</span></label>
                                                    <input type="text" id="txtCompanyPhone" class="form-control" value="@Model.Phone" onkeypress="removeInvalidClass('txtCompanyPhone')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtCountry">Country <span class="red-req">*</span></label>
                                                    <input type="text" id="txtCountry" class="form-control" value="@Model.Address.Country" onkeypress="removeInvalidClass('txtCountry')" />
                                                </div>

                                            </div>

                                            <div class="row mt-20">

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtStreet">Street <span class="red-req">*</span></label>
                                                    <input type="text" id="txtStreet" class="form-control" value="@Model.Address.Street" onkeypress="removeInvalidClass('txtStreet')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtCity">City <span class="red-req">*</span></label>
                                                    <input type="text" id="txtCity" class="form-control" value="@Model.Address.City" onkeypress="removeInvalidClass('txtCity')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtState">State <span class="red-req">*</span></label>
                                                    <input type="text" id="txtState" class="form-control" value="@Model.Address.State" onkeypress="removeInvalidClass('txtState')" />
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtZip">Zip <span class="red-req">*</span></label>
                                                    <input type="text" id="txtZip" class="form-control" value="@Model.Address.Zip" onkeypress="removeInvalidClass('txtZip')" />
                                                </div>

                                            </div>

                                            <div class="row mt-20">

                                           

                                                <div class="col-md-3 mb-3">
                                                    <label class="form-label" for="txtLocation">Location <span class="red-req">*</span></label>
                                                    <input type="text" id="txtLocation" class="form-control" value="@Model.Address.Location" onkeypress="removeInvalidClass('txtLocation')" />
                                                </div>

                                            </div>


                                            <div class="col-md-12 mt-20">
                                                <div class="row">
                                                    <div class="float-right">
                                                        <input type="hidden" id="hdnDealerId" value="@Model.Id" />
                                                        <input type="hidden" id="hdnUserId" value="@Model.UserDetail.Id" />
                                                        <input type="hidden" id="hdnUserIdP" value="@Model.UserDetail.Idp" />

                                                        <button type="button" class="btn btn-info" onclick="redirectoIndex()">Cancel</button>
                                                        <button type="button" id="saveDealer" class="btn btn-success" onclick="saveDealer()">Submit</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </div>


<script type="text/javascript">
    function redirectoIndex() {
        window.location.href = "/Admin/Dashboard";
    }

    function removeInvalidClass(controlId) {
        $("#" + controlId).hasClass("is-invalid")
        {
            $("#" + controlId).removeClass("is-invalid");
        }
    }

    $(document).ready(function () {
        stopCharacters();
    });

    function saveDealer() {
        if (!validateDealerSave()) {
            showMessage("Pleae fill all required fields then continue", "alert alert-danger")
        }
        else {
            var id = $("#hdnDealerId").val();
            var messageText = "Save"
            var pUrl = "/Dealers/AddDealer";
            if (id != null && id != "") {
                messageText = "Update"
                pUrl = "/Dealers/EditDealer";
            }

            var firstName = $("#txtFirstName").val();
            var lastName = $("#txtLastName").val();
            var userCountry = $("#txtUserCountry").val();
            var userEmail = $("#txtUserEmail").val();
            var companyName = $("#txtCompanyName").val();
            var companyEmail = $("#txtCompanyEmail").val();
            var companyPhone = $("#txtCompanyPhone").val();
            var country = $("#txtCountry").val();
            var street = $("#txtStreet").val();
            var city = $("#txtCity").val();
            var state = $("#txtState").val();
            var zip = $("#txtZip").val();
            var location = $("#txtLocation").val();

            var dealerAddress = { Country: country, Street: street, City: city, State: state, Zip: zip, Location: location }
            var userAddress = { Country: userCountry}
            var userDetail = {
                FirstName: firstName, LastName: lastName,
                Email: userEmail, Address: userAddress, Id: $("#hdnUserId").val(), Idp: $("#hdnUserIdP").val(), UserType : "Dealer"
            }

            var dealer = {
                Id: id, CompanyName: companyName, Email: companyEmail, Phone: companyPhone,
                Address: dealerAddress, UserDetail: userDetail
            };

            var jStr = "dealer=" + JSON.stringify(dealer);

            $.ajax({
                type: "POST",
                data: jStr,
                url: pUrl,
                dataType: "json",
                success: function (data) {
                    if (data != null) {
                        if (data.result == true) {
                            showMessage("Profile " + messageText + " successfully", "alert alert-success");
                            $("#hdnDealerId").val(data.dealerId); //Set car id to hidden after save
                        }
                        else {
                            showMessage("Error occured while " + messageText + " the profile", "alert alert-danger");
                        }
                    }
                    else {
                        showMessage("Error occured while " + messageText + " the profile", "alert alert-danger");
                    }
                },
                error: function (error) {
                    showMessage("Error occured while " + messageText + " the profile", "alert alert-danger");
                }

            });

        }
    }

    function validateDealerSave() {
        var lstInvalidControls = [];
        if (!$("#txtFirstName").val())
            lstInvalidControls.push('txtFirstName');
        if (!$("#txtLastName").val())
            lstInvalidControls.push('txtLastName');
        if (!$("#txtUserCountry").val())
            lstInvalidControls.push('txtUserCountry');
        if (!$("#txtCompanyName").val())
            lstInvalidControls.push('txtCompanyName');
        if (!$("#txtCompanyEmail").val())
            lstInvalidControls.push('txtCompanyEmail');
        if (!$("#txtCompanyPhone").val())
            lstInvalidControls.push('txtCompanyPhone');

        if (!$("#txtCountry").val())
            lstInvalidControls.push('txtCountry');
        if (!$("#txtStreet").val())
            lstInvalidControls.push('txtStreet');
        if (!$("#txtCity").val())
            lstInvalidControls.push('txtCity');
        if (!$("#txtState").val())
            lstInvalidControls.push('txtState');
        if (!$("#txtZip").val())
            lstInvalidControls.push('txtZip');
        if (!$("#txtLocation").val())
            lstInvalidControls.push('txtLocation');

        if (lstInvalidControls.length > 0) {
            lstInvalidControls.forEach(function (controlItem) {
                $("#" + controlItem).addClass("is-invalid");
            });
            return false;
        }
        return true;
    }

    function stopCharacters() {
        stopChar('txtCompanyPhone');
        stopChar('txtZip');
    }

    function showMessage(messageText, labelClass) {
        $("#divShowErrorSuccess").show();
        $("#divDetailText").html("<div class=\"" + labelClass + "\">" + messageText + "</div>");
        $(window).scrollTop(0);
        $('#divShowErrorSuccess').delay(8000).fadeOut('slow');
    }

    function stopChar(elem) {
        $("#" + elem).keydown(function (event) {
            // Allow special chars + arrows
            if (event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 9
                || event.keyCode == 27 || event.keyCode == 13
                || (event.keyCode == 65 && event.ctrlKey === true)
                || (event.keyCode >= 35 && event.keyCode <= 39)) {
                return;
            } else {
                // If it's not a number stop the keypress
                if (event.shiftKey || (event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105)) {
                    event.preventDefault();
                }
            }
        });
    }


</script>